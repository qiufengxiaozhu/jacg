<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zte.zudp.admin.mm.bigscreen.dao.ScreenDao">






    <!--趋势分析-->
    <select id="trendAnaly" resultType="java.util.Map">
        SELECT
            num,
            time,
            dest
        FROM
            (
            SELECT
                COUNT( RECID ) AS num,
                QUARTER ( NEWINSTTIME ) AS time,
                DISTRICTNAME dest
            FROM
                tocgcase
            WHERE
                NEWINSTTIME like '%2018%'
            GROUP BY
                QUARTER (NEWINSTTIME),
                DISTRICTNAME
        ) t
        GROUP BY
        dest,
        time
    </select>

    <!--显示最近12个月数据，显示三条-->
    <select id="selectCase" resultType="com.zte.zudp.admin.mm.bigscreen.entity.Screen">

        SELECT
            RECID,
            EVENTDESC,
            MAINTYPENAME,
            DATE_FORMAT( NEWINSTTIME, "%Y-%m" ) NEWINSTTIME
        FROM
            tocgcase
        WHERE
            date( NEWINSTTIME ) >= DATE_SUB( CURDATE( ), INTERVAL 12 MONTH )
        ORDER BY
            NEWINSTTIME DESC
            LIMIT 3
    </select>

    <!--统计2019年1月份所有区前十条案件-->
    <select id="selectAllCase" resultType="com.zte.zudp.admin.mm.bigscreen.entity.Screen">

        SELECT
            RECID,
            EVENTDESC,
            MAINTYPENAME,
            DATE_FORMAT( NEWINSTTIME, "%Y-%m" ) NEWINSTTIME
        FROM
            tocgcase
        WHERE
            NEWINSTTIME like '%2019-01%'
        ORDER BY
            NEWINSTTIME DESC
            LIMIT 10
    </select>

    <!--统计近一年每个区发生的事件有多少起-->
    <select id="countCase" resultType="com.zte.zudp.admin.mm.bigscreen.entity.Screen">

        SELECT
            DISTRICTNAME,
            COUNT( RECID ) as NUMBER
        FROM
            tocgcase
        WHERE
            date( NEWINSTTIME ) >= DATE_SUB( CURDATE( ), INTERVAL 12 MONTH )
        GROUP BY DISTRICTNAME

    </select>

    <!--效能分析-->
    <select id="analysis" resultType="com.zte.zudp.admin.mm.bigscreen.entity.Screen">

        SELECT
            *
        FROM
            qgq_case
        ORDER BY
            onTimeRate desc
            LIMIT 0,10
    </select>

    <select id="findType" resultType="java.util.Map">
        SELECT
        t.MAINTYPENAME as name,t.num
        FROM
        (
        SELECT
        MAINTYPENAME,
        COUNT(1) AS num
        FROM
        tocgcase
        GROUP BY
        MAINTYPENAME
        ) t
        ORDER BY
        t.num DESC limit 0,5;
 </select>


    <select id="findAreaList" resultType="java.util.Map">
        select DISTRICTNAME as name from tocgcase GROUP BY DISTRICTNAME;
   </select>

    <select id="findareacountList" resultType="java.lang.Integer">
       select COUNT(*) from tocgcase where DISTRICTNAME=  #{area} and  tocgcase.CREATETIME <![CDATA[ >= ]]>  #{startdate} and tocgcase.CREATETIME  <![CDATA[ <= ]]> #{enddate}
   </select>



    <select id="getrightEvenType" resultType="java.util.Map">
         select COMMUNITYNAME as name,round((COUNT(*)/10000),2)  as num from tocgcase GROUP BY COMMUNITYNAME ORDER BY
        round((COUNT(*)/10000),2) DESC limit 0,5;
     </select>

    <select id="getrightCaseNum" resultType="java.util.Map">
    select DISTRICTNAME as name,COUNT(*) as num from tocgcase where tocgcase.CREATETIME LIKE '%2017-12%'  GROUP BY DISTRICTNAME
   </select>

    <select id="getrightCasetypeNum" resultType="java.util.Map">
        select DISTRICTNAME as name,MAINTYPENAME as type,COUNT(*) as num  from tocgcase where DISTRICTNAME= #{name}
          and  tocgcase.CREATETIME <![CDATA[ >= ]]>  #{startdate} and tocgcase.CREATETIME  <![CDATA[ <= ]]> #{enddate}
          GROUP BY DISTRICTNAME,MAINTYPENAME
         ORDER BY COUNT(*) DESC

   </select>

    <select id="glCommunityList" resultType="java.util.Map">
        select DISTRICTNAME,STREETNAME,COMMUNITYNAME,MAINTYPENAME,EVENTSRCNAME  from  tocgcase
        where COMMUNITYNAME=#{name}  GROUP BY DISTRICTNAME,STREETNAME,COMMUNITYNAME,MAINTYPENAME,EVENTSRCNAME
    </select>

    <select id="glCaseList" resultType="java.util.Map">
        select DISTRICTNAME,STREETNAME ,MAX(COORDINATEX),MAX(COORDINATEY) from  tocgcase where STREETNAME is not null  GROUP BY DISTRICTNAME,STREETNAME
    </select>

    <select id="glindexCaseList" resultType="java.util.Map">
   select RECID,DISTRICTNAME,STREETNAME,MAINTYPENAME,EVENTDESC,DATE_FORMAT(DEADLINE,'%Y-%m-%d' ) as DEADLINE  from  tocgcase where STREETNAME=#{name}
    limit ${pages},10;
   </select>


    <select id="glindexCaseListCount" resultType="java.lang.Integer">
    select COUNT(*)  from  tocgcase where STREETNAME=#{name}
   </select>

    <select id="glindexCaseid" resultType="java.util.Map">
        SELECT
            IFNULL(DISTRICTNAME,'') as DISTRICTNAME,
            IFNULL(STREETNAME,'') as STREETNAME,
            IFNULL(EVENTSRCNAME,'') as EVENTSRCNAME,
            IFNULL(MAINTYPENAME,'') as MAINTYPENAME,
            IFNULL(SUBTYPENAME,'') as SUBTYPENAME,
            IFNULL(EVENTDESC,'') as EVENTDESC,
            IFNULL(ADDRESS,'') as ADDRESS,
            IFNULL(DATE_FORMAT(DEADLINE,'%Y-%m-%d %H:%i:%S'),'') as DEADLINE,
            IFNULL(DATE_FORMAT(ENDTIME,'%Y-%m-%d %H:%i:%S'),'') as ENDTIME,
            IFNULL(DISPOSEOPINION,'') as DISPOSEOPINION,
            IFNULL(DISPOSEDEPARTNAME,'') as DISPOSEDEPARTNAME,
            IFNULL(DATE_FORMAT(DEALTIME,'%Y-%m-%d %H:%i:%S'),'') as DATEFORMAT
        FROM
            tocgcase
        where RECID=#{id}
    </select>


    <select id="glindexManholeis" resultType="java.util.Map">
      select * from tomanholeis
   </select>

</mapper>